<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 페이지</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        table { width: 90%; margin: 20px auto; border-collapse: collapse; }
        th, td { padding: 10px; border: 1px solid black; text-align: center; }
        input, button, select { padding: 8px; margin: 5px; font-size: 16px; }
        .filter-container { margin-bottom: 15px; }
    </style>
</head>
<body>

    <h2>학생 관리</h2>

    <form id="studentForm">
        <input type="text" id="name" placeholder="이름" required>
        <input type="text" id="school" placeholder="학교">
        <input type="text" id="grade" placeholder="학년">
        <select id="gender">
            <option value="남">남</option>
            <option value="여">여</option>
        </select>
        <input type="text" id="contact" placeholder="연락처">
        
        <h3>출석 요일 선택</h3>
        <label><input type="checkbox" id="attend-mon"> 월</label>
        <label><input type="checkbox" id="attend-tue"> 화</label>
        <label><input type="checkbox" id="attend-wed"> 수</label>
        <label><input type="checkbox" id="attend-thu"> 목</label>
        <label><input type="checkbox" id="attend-fri"> 금</label>
        <label><input type="checkbox" id="attend-sat"> 토</label>
        <label><input type="checkbox" id="attend-sun"> 일</label>
        
        <br><br>
        <button type="submit">학생 추가</button>
    </form>

    <h3>학생 목록</h3>
    <table>
        <thead>
            <tr>
                <th>이름</th>
                <th>학교</th>
                <th>학년</th>
                <th>성별</th>
                <th>연락처</th>
                <th>출석 요일</th>
                <th>수정</th>
                <th>삭제</th>
            </tr>
        </thead>
        <tbody id="studentList"></tbody>
    </table>

    <script>
        const API_URL = "https://supermax.kr";

        // ✅ 학생 추가 기능 (입력 후 초기화, 추가 후 목록 새로고침)
        document.getElementById("studentForm").addEventListener("submit", async function (event) {
            event.preventDefault();

            const studentData = {
                이름: document.getElementById("name").value,
                학교: document.getElementById("school").value,
                학년: document.getElementById("grade").value,
                성별: document.getElementById("gender").value,
                연락처: document.getElementById("contact").value,
                출석_월: document.getElementById("attend-mon").checked ? 1 : 0,
                출석_화: document.getElementById("attend-tue").checked ? 1 : 0,
                출석_수: document.getElementById("attend-wed").checked ? 1 : 0,
                출석_목: document.getElementById("attend-thu").checked ? 1 : 0,
                출석_금: document.getElementById("attend-fri").checked ? 1 : 0,
                출석_토: document.getElementById("attend-sat").checked ? 1 : 0,
                출석_일: document.getElementById("attend-sun").checked ? 1 : 0
            };

            try {
                const response = await fetch(API_URL + "/adminstudent", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(studentData),
                });

                if (!response.ok) {
                    throw new Error("학생 추가 실패");
                }

                alert("학생 추가 완료!");
                document.getElementById("studentForm").reset();
                loadStudents();
            } catch (error) {
                console.error("학생 추가 오류:", error);
                alert("학생 추가에 실패했습니다.");
            }
        });

        // ✅ 학생 목록 로드
        async function loadStudents() {
            const response = await fetch(API_URL + "/adminstudents");
            const students = await response.json();

            const table = document.getElementById("studentList");
            table.innerHTML = students.map(s => `
                <tr data-id="${s.id}">
                    <td>${s.이름}</td>
                    <td>${s.학교}</td>
                    <td>${s.학년}</td>
                    <td>${s.성별}</td>
                    <td>${s.연락처}</td>
                    <td>${formatAttendanceDays(s)}</td>
                    <td><button onclick="editStudent(${s.id})">수정</button></td>
                    <td><button onclick="deleteStudent(${s.id})">삭제</button></td>
                </tr>
            `).join("");
        }

        function formatAttendanceDays(s) {
            return [
                s.출석_월 ? "월" : "", s.출석_화 ? "화" : "", s.출석_수 ? "수" : "",
                s.출석_목 ? "목" : "", s.출석_금 ? "금" : "", s.출석_토 ? "토" : "", s.출석_일 ? "일" : ""
            ].filter(Boolean).join(" ");
        }

        async function deleteStudent(id) {
            await fetch(API_URL + `/adminstudent/${id}`, { method: "DELETE" });
            loadStudents();
        }

        // ✅ 수정 기능 (기존 코드 유지)
        function editStudent(id) {
            const row = document.querySelector(tr[data-id="${id}"]);
            const cells = row.children;

            row.innerHTML = 
                <td><input type="text" value="${cells[0].innerText}" id="edit-name-${id}"></td>
                <td><input type="text" value="${cells[1].innerText}" id="edit-school-${id}"></td>
                <td><input type="text" value="${cells[2].innerText}" id="edit-grade-${id}"></td>
                <td><select id="edit-gender-${id}">
                    <option value="남" ${cells[3].innerText === "남" ? "selected" : ""}>남</option>
                    <option value="여" ${cells[3].innerText === "여" ? "selected" : ""}>여</option>
                </select></td>
                <td><input type="text" value="${cells[4].innerText}" id="edit-contact-${id}"></td>
                <td>
                    <label><input type="checkbox" id="edit-attend-mon-${id}"> 월</label>
                    <label><input type="checkbox" id="edit-attend-tue-${id}"> 화</label>
                    <label><input type="checkbox" id="edit-attend-wed-${id}"> 수</label>
                    <label><input type="checkbox" id="edit-attend-thu-${id}"> 목</label>
                    <label><input type="checkbox" id="edit-attend-fri-${id}"> 금</label>
                    <label><input type="checkbox" id="edit-attend-sat-${id}"> 토</label>
                    <label><input type="checkbox" id="edit-attend-sun-${id}"> 일</label>
                </td>
                <td><button onclick="saveEdit(${id})">저장</button></td>
            ;
        }

        async function saveEdit(id) {
            const updatedData = {
                이름: document.getElementById(edit-name-${id}).value,
                학교: document.getElementById(edit-school-${id}).value,
                학년: document.getElementById(edit-grade-${id}).value,
                성별: document.getElementById(edit-gender-${id}).value,
                연락처: document.getElementById(edit-contact-${id}).value,
                출석_월: document.getElementById(edit-attend-mon-${id}).checked ? 1 : 0,
                출석_화: document.getElementById(edit-attend-tue-${id}).checked ? 1 : 0,
                출석_수: document.getElementById(edit-attend-wed-${id}).checked ? 1 : 0,
                출석_목: document.getElementById(edit-attend-thu-${id}).checked ? 1 : 0,
                출석_금: document.getElementById(edit-attend-fri-${id}).checked ? 1 : 0,
                출석_토: document.getElementById(edit-attend-sat-${id}).checked ? 1 : 0,
                출석_일: document.getElementById(edit-attend-sun-${id}).checked ? 1 : 0
            };

            await fetch(API_URL + /adminstudent/${id}, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(updatedData),
            });

            loadStudents();
        }

        loadStudents();
    </script>

</body>
</html>
