<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 페이지</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        table { width: 90%; margin: 20px auto; border-collapse: collapse; }
        th, td { padding: 10px; border: 1px solid black; text-align: center; }
        input, button, select { padding: 8px; margin: 5px; font-size: 16px; }
        .filter-container { margin-bottom: 15px; }
        .edit-mode input, .edit-mode select { width: 80px; }
    </style>
</head>
<body>

    <h2>학생 관리</h2>

    <div class="filter-container">
        <label>학년: 
            <select id="filter-grade">
                <option value="">전체</option>
                <option value="1">1학년</option>
                <option value="2">2학년</option>
                <option value="3">3학년</option>
            </select>
        </label>
        <label>성별: 
            <select id="filter-gender">
                <option value="">전체</option>
                <option value="남">남</option>
                <option value="여">여</option>
            </select>
        </label>
        <button onclick="loadStudents()">필터 적용</button>
    </div>

    <form id="studentForm">
        <input type="text" id="name" placeholder="이름" required>
        <input type="text" id="school" placeholder="학교">
        <input type="text" id="grade" placeholder="학년">
        <select id="gender">
            <option value="남">남</option>
            <option value="여">여</option>
        </select>
        <input type="text" id="contact" placeholder="연락처">
        
        <h3>출석 요일 선택</h3>
        <label><input type="checkbox" id="attend-mon"> 월</label>
        <label><input type="checkbox" id="attend-tue"> 화</label>
        <label><input type="checkbox" id="attend-wed"> 수</label>
        <label><input type="checkbox" id="attend-thu"> 목</label>
        <label><input type="checkbox" id="attend-fri"> 금</label>
        <label><input type="checkbox" id="attend-sat"> 토</label>
        <label><input type="checkbox" id="attend-sun"> 일</label>
        
        <br><br>
        <button type="submit">학생 추가</button>
    </form>

    <h3>학생 목록</h3>
    <table>
        <thead>
            <tr>
                <th>이름</th>
                <th>학교</th>
                <th>학년</th>
                <th>성별</th>
                <th>연락처</th>
                <th>출석 요일</th>
                <th>수정</th>
                <th>삭제</th>
            </tr>
        </thead>
        <tbody id="studentList"></tbody>
    </table>

    <script>
        const API_URL = "https://supermax.kr";

        async function loadStudents() {
            const response = await fetch(API_URL + "/adminstudents");
            const students = await response.json();
            const gradeFilter = document.getElementById("filter-grade").value;
            const genderFilter = document.getElementById("filter-gender").value;

            const table = document.getElementById("studentList");
            table.innerHTML = students
                .filter(s => (!gradeFilter || s.학년 === gradeFilter) && (!genderFilter || s.성별 === genderFilter))
                .map(s => `
                    <tr data-id="${s.id}">
                        <td>${s.이름}</td>
                        <td>${s.학교}</td>
                        <td>${s.학년}</td>
                        <td>${s.성별}</td>
                        <td>${s.연락처}</td>
                        <td>${formatAttendanceDays(s)}</td>
                        <td><button onclick="editStudent(${s.id})">수정</button></td>
                        <td><button onclick="deleteStudent(${s.id})">삭제</button></td>
                    </tr>
                `).join("");
        }

        function formatAttendanceDays(s) {
            return [
                s.출석_월 ? "월" : "", s.출석_화 ? "화" : "", s.출석_수 ? "수" : "",
                s.출석_목 ? "목" : "", s.출석_금 ? "금" : "", s.출석_토 ? "토" : "", s.출석_일 ? "일" : ""
            ].filter(Boolean).join(" ");
        }

        async function deleteStudent(id) {
            await fetch(API_URL + `/adminstudent/${id}`, { method: "DELETE" });
            loadStudents();
        }

        function editStudent(id) {
            const row = document.querySelector(`tr[data-id="${id}"]`);
            const cells = row.children;

            row.innerHTML = `
                <td><input type="text" value="${cells[0].innerText}" id="edit-name-${id}"></td>
                <td><input type="text" value="${cells[1].innerText}" id="edit-school-${id}"></td>
                <td><input type="text" value="${cells[2].innerText}" id="edit-grade-${id}"></td>
                <td><select id="edit-gender-${id}">
                    <option value="남" ${cells[3].innerText === "남" ? "selected" : ""}>남</option>
                    <option value="여" ${cells[3].innerText === "여" ? "selected" : ""}>여</option>
                </select></td>
                <td><input type="text" value="${cells[4].innerText}" id="edit-contact-${id}"></td>
                <td><button onclick="saveEdit(${id})">저장</button></td>
            `;
        }

        async function saveEdit(id) {
            const updatedData = {
                이름: document.getElementById(`edit-name-${id}`).value,
                학교: document.getElementById(`edit-school-${id}`).value,
                학년: document.getElementById(`edit-grade-${id}`).value,
                성별: document.getElementById(`edit-gender-${id}`).value,
                연락처: document.getElementById(`edit-contact-${id}`).value
            };

            await fetch(API_URL + `/adminstudent/${id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(updatedData),
            });

            loadStudents();
        }

        loadStudents();
    </script>

</body>
</html>
