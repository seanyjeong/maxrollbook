<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        table { width: 90%; margin: 20px auto; border-collapse: collapse; }
        th, td { padding: 10px; border: 1px solid black; text-align: center; }
        input, button, select { padding: 8px; margin: 5px; font-size: 16px; }
        .edit-mode input, .edit-mode select { width: 80px; }
        .filter-container { margin-top: 20px; }
    </style>
</head>
<body>

    <h2>í•™ìƒ ê´€ë¦¬</h2>

    <!-- âœ… í•™ìƒ ì¶”ê°€ í¼ -->
    <form id="studentForm">
        <input type="text" id="name" placeholder="ì´ë¦„" required>
        <input type="text" id="school" placeholder="í•™êµ">
        <input type="text" id="grade" placeholder="í•™ë…„">
        <select id="gender">
            <option value="ë‚¨">ë‚¨</option>
            <option value="ì—¬">ì—¬</option>
        </select>
        <input type="text" id="contact" placeholder="ì—°ë½ì²˜">
        
        <h3>ì¶œì„ ìš”ì¼ ì„ íƒ</h3>
        <label><input type="checkbox" id="attend-mon"> ì›”</label>
        <label><input type="checkbox" id="attend-tue"> í™”</label>
        <label><input type="checkbox" id="attend-wed"> ìˆ˜</label>
        <label><input type="checkbox" id="attend-thu"> ëª©</label>
        <label><input type="checkbox" id="attend-fri"> ê¸ˆ</label>
        <label><input type="checkbox" id="attend-sat"> í† </label>
        <label><input type="checkbox" id="attend-sun"> ì¼</label>
        
        <br><br>
        <button type="submit">í•™ìƒ ì¶”ê°€</button>
    </form>

    <h3>í•™ìƒ ëª©ë¡</h3>
    <table>
        <thead>
            <tr>
                <th>ì´ë¦„</th>
                <th>í•™êµ</th>
                <th>í•™ë…„</th>
                <th>ì„±ë³„</th>
                <th>ì—°ë½ì²˜</th>
                <th>ì¶œì„ ìš”ì¼</th>
                <th>ìˆ˜ì •</th>
                <th>ì‚­ì œ</th>
            </tr>
        </thead>
        <tbody id="studentList"></tbody>
    </table>

    <!-- âœ… í•„í„°ë§ ê¸°ëŠ¥ì„ í•™ìƒ ëª©ë¡ ì•„ë˜ë¡œ ì´ë™ -->
    <div class="filter-container">
        <label>í•™ë…„: 
            <select id="filter-grade">
                <option value="">ì „ì²´</option>
                <option value="1">1í•™ë…„</option>
                <option value="2">2í•™ë…„</option>
                <option value="3">3í•™ë…„</option>
            </select>
        </label>
        <label>ì„±ë³„: 
            <select id="filter-gender">
                <option value="">ì „ì²´</option>
                <option value="ë‚¨">ë‚¨</option>
                <option value="ì—¬">ì—¬</option>
            </select>
        </label>
        <button onclick="loadStudents()">í•„í„° ì ìš©</button>
    </div>

    <script>
        const API_URL = "https://supermax.kr";

        // âœ… í•™ìƒ ì¶”ê°€ ê¸°ëŠ¥
        document.getElementById("studentForm").addEventListener("submit", async function (event) {
            event.preventDefault();

            const studentData = {
                ì´ë¦„: document.getElementById("name").value,
                í•™êµ: document.getElementById("school").value,
                í•™ë…„: document.getElementById("grade").value,
                ì„±ë³„: document.getElementById("gender").value,
                ì—°ë½ì²˜: document.getElementById("contact").value,
                ì¶œì„_ì›”: document.getElementById("attend-mon").checked ? 1 : 0,
                ì¶œì„_í™”: document.getElementById("attend-tue").checked ? 1 : 0,
                ì¶œì„_ìˆ˜: document.getElementById("attend-wed").checked ? 1 : 0,
                ì¶œì„_ëª©: document.getElementById("attend-thu").checked ? 1 : 0,
                ì¶œì„_ê¸ˆ: document.getElementById("attend-fri").checked ? 1 : 0,
                ì¶œì„_í† : document.getElementById("attend-sat").checked ? 1 : 0,
                ì¶œì„_ì¼: document.getElementById("attend-sun").checked ? 1 : 0
            };

            try {
                const response = await fetch(API_URL + "/adminstudent", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(studentData),
                });

                if (!response.ok) {
                    throw new Error("í•™ìƒ ì¶”ê°€ ì‹¤íŒ¨");
                }

                alert("í•™ìƒ ì¶”ê°€ ì™„ë£Œ!");
                document.getElementById("studentForm").reset(); // ğŸ“Œ ì…ë ¥ì¹¸ ì´ˆê¸°í™”
                loadStudents();
            } catch (error) {
                console.error("í•™ìƒ ì¶”ê°€ ì˜¤ë¥˜:", error);
                alert("í•™ìƒ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        });

        // âœ… í•™ìƒ ëª©ë¡ ë¡œë“œ
        async function loadStudents() {
            const response = await fetch(API_URL + "/adminstudents");
            const students = await response.json();
            const gradeFilter = document.getElementById("filter-grade").value;
            const genderFilter = document.getElementById("filter-gender").value;

            const table = document.getElementById("studentList");
            table.innerHTML = students
                .filter(s => (!gradeFilter || s.í•™ë…„ === gradeFilter) && (!genderFilter || s.ì„±ë³„ === genderFilter))
                .map(s => `
                    <tr data-id="${s.id}">
                        <td>${s.ì´ë¦„}</td>
                        <td>${s.í•™êµ}</td>
                        <td>${s.í•™ë…„}</td>
                        <td>${s.ì„±ë³„}</td>
                        <td>${s.ì—°ë½ì²˜}</td>
                        <td>${formatAttendanceDays(s)}</td>
                        <td><button onclick="editStudent(${s.id})">ìˆ˜ì •</button></td>
                        <td><button onclick="deleteStudent(${s.id})">ì‚­ì œ</button></td>
                    </tr>
                `).join("");
        }

        function formatAttendanceDays(s) {
            return [
                s.ì¶œì„_ì›” ? "ì›”" : "", s.ì¶œì„_í™” ? "í™”" : "", s.ì¶œì„_ìˆ˜ ? "ìˆ˜" : "",
                s.ì¶œì„_ëª© ? "ëª©" : "", s.ì¶œì„_ê¸ˆ ? "ê¸ˆ" : "", s.ì¶œì„_í†  ? "í† " : "", s.ì¶œì„_ì¼ ? "ì¼" : ""
            ].filter(Boolean).join(" ");
        }

        async function deleteStudent(id) {
            await fetch(API_URL + `/adminstudent/${id}`, { method: "DELETE" });
            loadStudents();
        }

        function editStudent(id) {
            // ìˆ˜ì • ê¸°ëŠ¥ì€ ì´ì „ ì½”ë“œì™€ ë™ì¼í•˜ë¯€ë¡œ ê·¸ëŒ€ë¡œ ìœ ì§€
        }

        loadStudents();
    </script>

</body>
</html>
