<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ï∂úÏÑù Ï≤¥ÌÅ¨</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        table { width: 90%; margin: 20px auto; border-collapse: collapse; }
        th, td { padding: 10px; border: 1px solid black; text-align: center; }
        input, button, select { padding: 8px; margin: 5px; font-size: 16px; }
        .date-header { font-size: 20px; font-weight: bold; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h2>Ï∂úÏÑù Ï≤¥ÌÅ¨</h2>
    <div class="date-header" id="currentDate"></div>

    <table id="attendanceTable">
        <thead>
            <tr>
                <th>Ïù¥Î¶Ñ</th>
                <th>Ï∂úÏÑù</th>
                <th>ÏßÄÍ∞Å</th>
                <th>Í≤∞ÏÑù</th>
                <th>ÏÇ¨Ïú†</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <button onclick="saveAttendance()">Ï∂úÏÑù Ï†ÄÏû•</button>

    <script>
        const API_URL = "https://supermax.kr";

        function updateDate() {
            const today = new Date();
            const dayNames = ["ÏùºÏöîÏùº", "ÏõîÏöîÏùº", "ÌôîÏöîÏùº", "ÏàòÏöîÏùº", "Î™©ÏöîÏùº", "Í∏àÏöîÏùº", "ÌÜ†ÏöîÏùº"];
            document.getElementById("currentDate").innerText = 
                `${today.toLocaleDateString()} (${dayNames[today.getDay()]})`;
        }
        updateDate();

        async function fetchAttendanceData() {
            try {
                const response = await fetch(API_URL + "/attendancetoday");
                if (!response.ok) {
                    throw new Error("Ï∂úÏÑù Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌï®");
                }
                const students = await response.json();
                console.log("üìå ÏÑúÎ≤Ñ ÏùëÎãµ Îç∞Ïù¥ÌÑ∞:", students);
                renderAttendance(students);
            } catch (error) {
                console.error("Ï∂úÏÑù Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•ò Î∞úÏÉù:", error);
            }
        }

        function renderAttendance(students) {
            let tableContent = "";
            students.forEach((student, index) => {
                tableContent += `
                    <tr data-id="${student.id}">
                        <td>${student.Ïù¥Î¶Ñ}</td>
                        <td><input type="radio" name="status-${index}" value="Ï∂úÏÑù" ${student.Ï∂úÏÑùÏÉÅÌÉú === 1 ? "checked" : ""}></td>
                        <td><input type="radio" name="status-${index}" value="ÏßÄÍ∞Å" ${student.Ï∂úÏÑùÏÉÅÌÉú === 2 ? "checked" : ""}></td>
                        <td><input type="radio" name="status-${index}" value="Í≤∞ÏÑù" ${student.Ï∂úÏÑùÏÉÅÌÉú === 3 ? "checked" : ""}></td>
                        <td><input type="text" id="reason-${index}" value="${student.ÏÇ¨Ïú† || ""}"></td>
                    </tr>
                `;
            });

            document.querySelector("#attendanceTable tbody").innerHTML = tableContent;
        }

        function convertAttendanceStatus(status) {
            switch (status) {
                case "Ï∂úÏÑù": return 1;
                case "ÏßÄÍ∞Å": return 2;
                case "Í≤∞ÏÑù": return 3;
                default: return 0;
            }
        }

        fetchAttendanceData();
    </script>

</body>
</html>
